---
title: "Neural signature development: holdout sample"
author: "Dani Cosme"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    df_print: paged
    highlight: tango
    theme: united
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: yes
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
options(scipen = 999)
```

# load packages
```{r}
library(pacman)
pacman::p_load(tidyverse, brms, ggeffects, tidybayes, ROCR, caret, interactions, install = TRUE)
devtools::install_github("hadley/emo")
```

# define aesthetics
```{r}
palette = c("#e64626", "#1985a1", "#4c5c68", "#FAC748")

plot_aes = theme_minimal() +
  theme(legend.position = "top",
        legend.text = element_text(size = 12),
        text = element_text(size = 16, family = "Futura Medium"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text = element_text(color = "black"),
        axis.line = element_line(colour = "black"),
        axis.ticks.y = element_blank())
```

# load and tidy data {.tabset}
```{r}
metadata = read.csv("../data_raw/metadata/metadata_cuereact.csv", stringsAsFactors = FALSE)

classifier_data = read.csv("../data_raw/dots_cond.csv", stringsAsFactors = FALSE) %>%
  extract(file, c("subjectID", "trial_type", "condition", "run"),
          ".*/(MURIC[0-9]{3}|MURIP[0-9]{3})_(alc_react|downreg)_(.*)_([1-4]{1})") %>%
  mutate(run = as.numeric(run)) %>%
  left_join(., metadata) %>%
  filter(sample == "holdout") %>%
  rename("predicted" = dot) %>%
  mutate(predicted_factor = ifelse(predicted > .5, "regulate", "react"),
         predicted_factor = as.factor(predicted_factor),
         actual = ifelse(trial_type == "downreg", 1, 0),
         actual_factor = ifelse(trial_type == "downreg", "regulate", "react"),
         actual_factor = as.factor(actual_factor))
```

# mindfulness signature development analysis

> First, we partitioned the data into two sets as follows: 75% of the data was used in the development of the signature (i.e., the development set), and 25% will be withheld as a hold out, or “lockbox” set to test out of sample accuracy once the signature has been satisfactorily developed in the development set. This procedure reduces the risk of decreased generalizability due to overfitting during signature development (Hosseini et al., 2020). 

```{r}
caret::confusionMatrix(classifier_data$predicted_factor, classifier_data$actual_factor)
```
